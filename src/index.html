<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SatPass</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script type="text/javascript" src="satellite.min.js"></script>
    <script type="text/javascript" src="sat-predict.js"></script>
    <script type="text/javascript" src="elm.js"></script>
</head>
<body></body>
<script>
  var app = Elm.Main.fullscreen();

  app.ports.sendPassReq.subscribe(function (req) {
      app.ports.recvPasses.send(SatPredict.getPasses(req));
  });

  app.ports.sendLookAngleReq.subscribe(function (req) {
      app.ports.recvLookAngles.send(SatPredict.getLookAngles(req));
  });

  // Geolocation
  var fallbackCoords = { 'latitude': 0.0, 'longitude': 0.0, 'altitude': 0.0 };

  var geoSuccess = function (pos) {
    var timestamp = (new Date()).getTime();
    app.ports.recvTimeAndCoords.send([timestamp, pos.coords]);
  };

  var geoFail = function (geoErr) {
      console.warn("Geolocation failed.");
      console.warn(geoErr);
      var timestamp = (new Date()).getTime();
      app.ports.recvTimeAndCoords.send([timestamp, fallbackCoords]);
  };

  var geoOptions = {
    enableHighAccuracy: false,
    maximumAge: 48 * 60 * 60 * 1000,  // 48 hours
    timeout: 10000
  };

  if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(geoSuccess, geoFail,
                                               geoOptions);
  } else {
      console.warn("Geolocation not available.");
      var timestamp = (new Date()).getTime();
      app.ports.recvTimeAndCoords.send([timestamp, fallbackCoords]);
  }

</script>
</html>
